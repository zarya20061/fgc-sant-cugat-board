
name: Generate FGC Board

on:
  schedule:
    - cron: "* * * * *" # запуск каждую минуту
  workflow_dispatch: # ручной запуск

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Клонируем репозиторий
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Устанавливаем Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # 3. Устанавливаем шрифты (для Pillow)
      - name: Install fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-dejavu-core

      # 4. Устанавливаем зависимости
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 5. Генерируем PNG с логированием
      - name: Generate board image
        run: |
          echo "Запуск скрипта генерации..."
          python generate.py
          echo "Содержимое директории после генерации:"
          ls -lh

      # 6. Проверяем, что PNG создан
      - name: Check PNG exists
        run: |
          if [ ! -f fgc_sant_cugat_pocketbook.png ]; then
            echo "❌ PNG не создан!"
            exit 1
          else
            echo "✅ PNG создан успешно!"
          fi

      # 7. Коммитим изменения, если PNG обновился
      - name: Commit and push if changed
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          if ! git diff --quiet; then
            echo "Изменения найдены, выполняем коммит..."
            git add fgc_sant_cugat_pocketbook.png
            git commit -m "Update board image"
            git push
          else
            echo "Нет изменений, коммит не требуется."
          fi
